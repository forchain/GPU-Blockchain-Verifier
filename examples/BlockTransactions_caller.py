import json
import mmap
from CoinbaseTransaction import getVarInt
from SegwitCoinbaseTransaction import getCoinbaseTransactionInfo
from SegwitBlockTransaction import getTransactionInfo

if __name__ == '__main__':
    # # trimmed block for block hash 000000000000000082ccf8f1557c5d40b21edabb18d2d691cfbf87118bac7254
    # blk_b = bytes.fromhex('020000007ef055e1674d2e6551dba41cd214debbee34aeb544c7ec670000000000000000d3998963f80c5bab43fe8c26228e98d030edf4dcbe48a666f5c39e2d7a885c9102c86d536c890019593a470ded01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4803e09304062f503253482f0403c86d53087ceca141295a00002e522cfabe6d6d7561cf262313da1144026c8f7a43e3899c44f6145f39a36507d36679a8b7006104000000000000000000000001c8704095000000001976a91480ad90d403581fa3bf46086a91b2d9d4125db6c188ac0000000001000000014dff4050dcee16672e48d755c6dd25d324492b5ea306f85a3ab23b4df26e16e9000000008c493046022100cb6dc911ef0bae0ab0e6265a45f25e081fc7ea4975517c9f848f82bc2b80a909022100e30fb6bb4fb64f414c351ed3abaed7491b8f0b1b9bcd75286036df8bfabc3ea5014104b70574006425b61867d2cbb8de7c26095fbc00ba4041b061cf75b85699cb2b449c6758741f640adffa356406632610efb267cb1efa0442c207059dd7fd652eeaffffffff020049d971020000001976a91461cf5af7bb84348df3fd695672e53c7d5b3f3db988ac30601c0c060000001976a914fd4ed114ef85d350d6d40ed3f6dc23743f8f99c488ac00000000')
    #
    # trimmed block for block hash 00000000000000000002728d44f012b6c026016d5090357f22aaa99823a50885
    blk_b = bytes.fromhex('000000203175cac6710aeb82bc227d9038a1a78f023ae72b01600b000000000000000000ba77ada15c4fbe908266708c933fe8e5754b5e5388fddbd5f36ba12c81a9f4da1c1fe25e357f14175d7ac585fdfc09010000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff640351ad092cfabe6d6d7247c8f308d874d3541c9fe6bbd83d3280d6db25ce614b3637649dc9654f71a910000000f09f909f082f4632506f6f6c2f0e4d696e6564206279206d61746f780000000000000000000000000000000000000000000500657233b300000000044cf5b527000000001976a914c825a1ecf2a6830c4401620c3a16f1995057c2ab88ac00000000000000002f6a24aa21a9ed546e11d83d2df006b3e2a0aca441e712d57a6b4151cad6c57778eb13f2106d0508000000000000000000000000000000002c6a4c2952534b424c4f434b3a9cfc7f3481efc28121a82fee5bc887b96f721e946535196f3d2bab26002523470000000000000000266a24b9e11b6d33fecb4920c8b7a7812f72de346b8db6d1813ba9a8e8a1245a6e7a7af64c51740120000000000000000000000000000000000000000000000000000000000000000046154d4202000000035f9e433bcb2da727fbb8601c01bcb37fc8f8817af2b4a44b6a0325d16ad630c9000000006b483045022100c7261e753bcb0d316ab8706de5e44e5d64042a42d0bf53d6cbaa0019b2e91ef502207a7cabf12152d19a92d2db5e676f356afe9e09f44f9fca235781086f182a29e9012102490baeefbc90f7d68f8ab1e690f7af6f88fd8bbf8312c878e9874a8a7fd06165fdffffff86240acda6bb785dbcffedc53f1f34402055ba7413037bb4c652a20b473a51d4000000006b4830450221008c43b117485bec0baed05001e6b514b393a1308d445af472e2d162b45e53492302202e64d8b1d7a125bf47b6163013006a25f5c2e77ef4f348c54ce4aee75043')
    blk_m = mmap.mmap(-1, len(blk_b) + 1)
    blk_m.write(blk_b)
    blk_m.seek(80)
    tx_cnt = getVarInt(blk_m)
    coinbase_tx = getCoinbaseTransactionInfo(blk_m)
    print('Coinbase:')
    print(json.dumps(coinbase_tx, indent=4))
    tx = getTransactionInfo(blk_m)
    print('Transaction:')
    print(json.dumps(tx, indent=4))
